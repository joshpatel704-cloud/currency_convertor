<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RateX Pro - Currency Converter</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,800;1,900&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        
        /* Spin animation for swap button */
        .spin-once {
            animation: spin 0.3s ease-in-out;
        }
        @keyframes spin {
            from { transform: rotate(0deg) scale(0.9); }
            to { transform: rotate(180deg) scale(1); }
        }
        
        /* Number transition wrapper */
        .number-transition {
            font-variant-numeric: tabular-nums;
        }

        /* Hide elements gracefully */
        .tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
        }

        /* Custom Scrollbar for Dropdowns */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #475569;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 font-sans transition-colors duration-300 selection:bg-blue-500 selection:text-white pb-10">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-slate-900 text-white shadow-lg shadow-slate-900/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 50" class="h-10 w-auto drop-shadow-md">
                        <defs>
                            <linearGradient id="logoXGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#38bdf8" />
                                <stop offset="40%" stop-color="#4ade80" />
                                <stop offset="100%" stop-color="#16a34a" />
                            </linearGradient>
                            <linearGradient id="logoBarGreen" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#84cc16" />
                                <stop offset="100%" stop-color="#4ade80" />
                            </linearGradient>
                            <linearGradient id="logoBarBlue" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#38bdf8" />
                                <stop offset="100%" stop-color="#2563eb" />
                            </linearGradient>
                        </defs>
                        <!-- rate -->
                        <text x="0" y="32" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="24" fill="#ffffff" letter-spacing="-0.5">rate</text>
                        <!-- X -->
                        <text x="46" y="34" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="36" fill="url(#logoXGrad)">X</text>
                        <!-- pro -->
                        <text x="76" y="32" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="18" fill="#84cc16" letter-spacing="-0.5">pro</text>
                        <!-- Chart Bars -->
                        <rect x="25" y="38" width="5" height="4" fill="url(#logoBarGreen)" rx="1"/>
                        <rect x="32" y="33" width="5" height="9" fill="url(#logoBarGreen)" rx="1"/>
                        <rect x="39" y="27" width="5" height="15" fill="url(#logoBarBlue)" rx="1"/>
                        <rect x="46" y="20" width="5" height="22" fill="url(#logoBarBlue)" rx="1"/>
                        <!-- Swoosh arrow -->
                        <path d="M 0 42 Q 25 40 48 24" fill="none" stroke="#38bdf8" stroke-width="2.5" stroke-linecap="round"/>
                        <polygon points="46,20 54,22 49,28" fill="#38bdf8" />
                    </svg>
                </div>

                <!-- Desktop Nav -->
                <nav class="hidden md:flex items-center gap-8 font-medium">
                    <button id="nav-personal" class="text-blue-400 border-b-2 border-blue-400 pb-1 transition-colors">Personal</button>
                    <button id="nav-chart" class="text-slate-300 hover:text-white border-b-2 border-transparent pb-1 transition-colors">Chart</button>
                </nav>

                <!-- Actions -->
                <div class="hidden md:flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 text-slate-300 hover:text-white bg-slate-800 hover:bg-slate-700 rounded-full transition-all" aria-label="Toggle Theme">
                        <i data-lucide="moon" id="theme-icon" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center gap-4">
                    <button id="mobile-theme-toggle" class="p-2 text-slate-300">
                        <i data-lucide="moon" id="mobile-theme-icon" class="w-5 h-5"></i>
                    </button>
                    <button id="mobile-menu-btn" class="p-2">
                        <i data-lucide="menu" id="mobile-menu-icon" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Nav -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-800 border-t border-slate-700 overflow-hidden transition-all duration-300">
            <div class="px-4 py-6 flex flex-col gap-4">
                <button id="mobile-nav-personal" class="text-left text-lg font-medium text-blue-400">Personal</button>
                <button id="mobile-nav-chart" class="text-left text-lg font-medium text-slate-300">Chart</button>
            </div>
        </div>
    </header>

    <!-- ==================== PERSONAL VIEW ==================== -->
    <div id="view-personal" class="tab-content active">
        <!-- HERO SECTION -->
        <section class="relative pt-12 md:pt-20 pb-20 md:pb-32 overflow-hidden">
            <!-- Background gradient graphics -->
            <div class="absolute inset-0 bg-slate-900 pointer-events-none" style="clip-path: polygon(0 0, 100% 0, 100% 60%, 0 85%);">
                <div class="absolute top-0 right-0 -translate-y-12 translate-x-1/3 w-96 h-96 bg-blue-600/20 rounded-full blur-3xl"></div>
                <div class="absolute bottom-1/2 left-0 -translate-x-1/3 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl"></div>
            </div>

            <div class="relative max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white tracking-tight mb-6 animate-fade-in-up opacity-0">
                    Live Currency Converter
                </h1>
                <p class="text-lg md:text-xl text-slate-300 max-w-2xl mx-auto mb-12 animate-fade-in-up delay-100 opacity-0">
                    Check real-time foreign exchange rates instantly. Trusted by millions of users worldwide for accurate and fast conversions.
                </p>

                <!-- CONVERTER CARD -->
                <div class="bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-slate-800 shadow-2xl rounded-3xl p-6 md:p-10 text-left animate-fade-in-up delay-200 opacity-0">
                    
                    <div id="error-message" class="hidden mb-6 p-4 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 text-amber-700 dark:text-amber-400 rounded-xl text-sm font-medium flex items-center gap-2">
                        <i data-lucide="alert-triangle" class="w-5 h-5 shrink-0"></i> <span id="error-text"></span>
                    </div>

                    <!-- Layout for Desktop (3 columns) and Mobile (Stacked with Swap correctly centered) -->
                    <div class="flex flex-col md:flex-row items-end gap-4 md:gap-6 relative z-10">
                        
                        <!-- Amount Input Box -->
                        <div class="w-full md:w-[30%]">
                            <label class="block text-sm font-semibold text-slate-600 dark:text-slate-400 mb-2">Amount</label>
                            <div class="relative border-2 border-slate-200 dark:border-slate-700 focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-500/20 rounded-xl transition-all overflow-hidden bg-white dark:bg-slate-950 h-[68px] flex items-center">
                                <span id="currency-symbol" class="absolute left-4 text-slate-400 font-bold text-xl">$</span>
                                <input 
                                    type="number" 
                                    id="amount-input"
                                    value="1000"
                                    class="w-full h-full bg-transparent pl-10 pr-4 text-2xl font-bold text-slate-900 dark:text-white outline-none"
                                    placeholder="0.00"
                                />
                            </div>
                        </div>

                        <!-- Custom FROM & TO Selector Wrapper -->
                        <div class="w-full md:w-[70%] relative flex flex-col md:flex-row gap-4 md:gap-6">
                            
                            <!-- FROM Dropdown -->
                            <div class="w-full relative z-30">
                                <label class="block text-sm font-semibold text-slate-600 dark:text-slate-400 mb-2">From</label>
                                <div id="from-currency-container" class="border-2 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 rounded-xl transition-all bg-white dark:bg-slate-950 h-[68px]">
                                    <!-- Injected via CustomSelect -->
                                </div>
                            </div>

                            <!-- SWAP Button (Absolutely centered perfectly between From & To) -->
                            <div class="absolute left-1/2 top-[calc(50%+14px)] -translate-x-1/2 -translate-y-1/2 md:static md:translate-x-0 md:translate-y-0 z-40 md:z-10 flex-shrink-0 flex items-center mt-0 md:mt-7">
                                <button id="swap-btn" class="bg-blue-600 text-white p-3.5 md:p-4 rounded-full shadow-lg shadow-blue-600/40 hover:bg-blue-700 transition-all border-[6px] border-white dark:border-slate-900 md:border-none group hover:scale-105" aria-label="Swap Currencies">
                                    <!-- Mobile Icon -->
                                    <i data-lucide="arrow-down-up" class="w-5 h-5 md:hidden transition-transform group-active:rotate-180"></i>
                                    <!-- Desktop Icon -->
                                    <i data-lucide="arrow-right-left" class="w-6 h-6 hidden md:block transition-transform group-active:rotate-180"></i>
                                </button>
                            </div>

                            <!-- TO Dropdown -->
                            <div class="w-full relative z-20">
                                <label class="block text-sm font-semibold text-slate-600 dark:text-slate-400 mb-2">To</label>
                                <div id="to-currency-container" class="border-2 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 rounded-xl transition-all bg-white dark:bg-slate-950 h-[68px]">
                                    <!-- Injected via CustomSelect -->
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Results Area -->
                    <div class="mt-10 pt-8 border-t border-slate-100 dark:border-slate-800 flex flex-col md:flex-row items-center justify-between gap-6 relative z-0">
                        <div class="flex-1 text-center md:text-left w-full">
                            
                            <!-- Skeleton Loader -->
                            <div id="result-skeleton" class="animate-pulse flex flex-col gap-2">
                                <div class="h-8 w-48 bg-slate-200 dark:bg-slate-800 rounded"></div>
                                <div class="h-12 w-64 bg-slate-200 dark:bg-slate-800 rounded"></div>
                            </div>
                            
                            <!-- Actual Data -->
                            <div id="result-data" class="hidden">
                                <p class="text-lg font-medium text-slate-500 dark:text-slate-400 mb-1">
                                    <span id="display-amount">1,000</span> <span id="display-from-curr">USD</span> =
                                </p>
                                <h2 class="text-4xl md:text-5xl font-extrabold text-slate-900 dark:text-white tracking-tight">
                                    <span id="display-result" class="number-transition">0.0000</span> <span id="display-to-curr" class="text-2xl md:text-3xl text-slate-500 font-semibold">EUR</span>
                                </h2>
                                <p class="mt-3 text-sm text-slate-500 font-medium">
                                    1 <span class="rate-from">USD</span> = <span id="display-rate">0.000000</span> <span class="rate-to">EUR</span>
                                </p>
                            </div>
                        </div>

                        <div class="flex flex-col items-center md:items-end gap-3 w-full md:w-auto">
                            <button id="convert-btn" class="w-full md:w-auto px-10 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold text-lg rounded-xl shadow-xl shadow-blue-600/20 transition-all hover:-translate-y-1">
                                Convert Now
                            </button>
                            <p class="text-xs text-slate-400 font-medium flex items-center gap-1">
                                <i data-lucide="activity" class="w-3 h-3"></i> Last updated: <span id="last-updated">--:--:--</span>
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- LIVE EXCHANGE RATES SECTION -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <div class="mb-10 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div>
                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Live Exchange Rates</h3>
                    <p class="text-slate-500 dark:text-slate-400">Current market rates for base currency: <strong id="table-base-currency" class="text-slate-900 dark:text-white">USD</strong></p>
                </div>
                <button id="refresh-rates-btn" class="text-sm font-semibold text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
                    <i data-lucide="activity" class="w-4 h-4"></i> Refresh Rates
                </button>
            </div>

            <!-- Rates Grid Container -->
            <div id="rates-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 relative z-0">
                <!-- Cards injected via JS -->
            </div>
        </section>
    </div>

    <!-- ==================== CHART VIEW ==================== -->
    <div id="view-chart" class="tab-content">
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">
            <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-xl rounded-3xl p-6 md:p-10">
                
                <!-- Chart Controls -->
                <div class="flex flex-col md:flex-row items-end gap-4 mb-8 bg-slate-50 dark:bg-slate-950/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-800 relative z-10">
                    <div class="flex-1 w-full relative z-30">
                        <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 uppercase tracking-wider">Reference (Base)</label>
                        <div id="chart-base-container" class="border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-900 h-11"></div>
                    </div>
                    <div class="flex-1 w-full relative z-20">
                        <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 uppercase tracking-wider">Currency A</label>
                        <div id="chart-curr1-container" class="border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-900 h-11"></div>
                    </div>
                    <div class="flex-1 w-full relative z-10">
                        <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 uppercase tracking-wider">Currency B (Compare)</label>
                        <div id="chart-curr2-container" class="border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-900 h-11"></div>
                    </div>
                </div>

                <!-- Chart Header -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 relative z-0">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-extrabold flex flex-wrap items-center gap-3">
                            <span id="chart-main-title" class="text-slate-900 dark:text-white">EUR to USD Chart</span>
                            <span id="chart-main-change" class="text-emerald-500 bg-emerald-100 dark:bg-emerald-900/30 px-3 py-1 rounded-full text-base md:text-lg">+12.71%</span>
                        </h2>
                        <p id="chart-main-subtitle" class="text-slate-500 font-medium mt-1">Euro to US Dollar</p>
                    </div>
                    <div class="text-left md:text-right bg-slate-50 dark:bg-slate-800/50 py-2 px-4 rounded-xl border border-slate-100 dark:border-slate-700">
                        <div class="flex items-center justify-start md:justify-end gap-2 text-sm md:text-base font-bold text-slate-900 dark:text-white">
                            <div class="w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse"></div>
                            <span id="chart-current-rate-text">1 EUR = 1.1821 USD</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1 font-medium" id="chart-date-text">Feb 27, 2026 at 17:47 UTC</p>
                    </div>
                </div>

                <!-- Timeframes & Custom Date Picker -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 relative z-0">
                    <div class="flex flex-wrap gap-2" id="chart-timeframes">
                        <button class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" data-tf="1W">1W</button>
                        <button class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" data-tf="1M">1M</button>
                        <button class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-blue-600 text-white shadow-md shadow-blue-600/20 transition-colors" data-tf="1Y">1Y</button>
                        <button class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" data-tf="5Y">5Y</button>
                        <button class="tf-btn px-4 py-1.5 text-sm font-semibold rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" data-tf="CUSTOM">Custom</button>
                    </div>
                    
                    <!-- Custom Date Range (Hidden by Default) -->
                    <div id="custom-date-range" class="hidden flex-wrap items-center gap-2 text-sm bg-slate-50 dark:bg-slate-900/50 p-2 rounded-xl border border-slate-200 dark:border-slate-800 w-full md:w-auto">
                        <input type="date" id="chart-start-date" class="bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-slate-700 dark:text-slate-300 outline-none focus:border-blue-500 flex-1 md:flex-none">
                        <span class="text-slate-400 font-medium">to</span>
                        <input type="date" id="chart-end-date" class="bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-slate-700 dark:text-slate-300 outline-none focus:border-blue-500 flex-1 md:flex-none">
                        <button id="apply-custom-date" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-800 dark:text-slate-200 px-3 py-1.5 rounded-lg font-semibold transition-colors w-full md:w-auto mt-2 md:mt-0">Apply</button>
                    </div>
                </div>

                <!-- Main Canvas -->
                <div class="w-full h-[400px] md:h-[500px] relative z-0">
                    <canvas id="big-chart"></canvas>
                </div>
                
                <p id="chart-comparison-note" class="text-center text-xs text-slate-400 mt-6 hidden">
                    *When comparing multiple currencies, the chart displays the normalized percentage change over the selected period.
                </p>
            </div>
        </section>
    </div>

    <!-- FOOTER -->
    <footer class="bg-slate-900 text-slate-400 py-12 border-t border-slate-800 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-8">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 50" class="h-8 w-auto drop-shadow-md">
                        <defs>
                            <linearGradient id="footerXGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#38bdf8" />
                                <stop offset="40%" stop-color="#4ade80" />
                                <stop offset="100%" stop-color="#16a34a" />
                            </linearGradient>
                            <linearGradient id="footerBarGreen" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#84cc16" />
                                <stop offset="100%" stop-color="#4ade80" />
                            </linearGradient>
                            <linearGradient id="footerBarBlue" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#38bdf8" />
                                <stop offset="100%" stop-color="#2563eb" />
                            </linearGradient>
                        </defs>
                        <!-- rate -->
                        <text x="0" y="32" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="24" fill="#ffffff" letter-spacing="-0.5">rate</text>
                        <!-- X -->
                        <text x="46" y="34" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="36" fill="url(#footerXGrad)">X</text>
                        <!-- pro -->
                        <text x="76" y="32" font-family="'Inter', sans-serif" font-weight="900" font-style="italic" font-size="18" fill="#84cc16" letter-spacing="-0.5">pro</text>
                        <!-- Chart Bars -->
                        <rect x="25" y="38" width="5" height="4" fill="url(#footerBarGreen)" rx="1"/>
                        <rect x="32" y="33" width="5" height="9" fill="url(#footerBarGreen)" rx="1"/>
                        <rect x="39" y="27" width="5" height="15" fill="url(#footerBarBlue)" rx="1"/>
                        <rect x="46" y="20" width="5" height="22" fill="url(#footerBarBlue)" rx="1"/>
                        <!-- Swoosh arrow -->
                        <path d="M 0 42 Q 25 40 48 24" fill="none" stroke="#38bdf8" stroke-width="2.5" stroke-linecap="round"/>
                        <polygon points="46,20 54,22 49,28" fill="#38bdf8" />
                    </svg>
                </div>
                <div class="text-sm flex flex-wrap justify-center gap-6">
                    <a href="#" class="hover:text-white transition-colors">About Us</a>
                    <a href="#" class="hover:text-white transition-colors">API Docs</a>
                    <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition-colors">Terms of Service</a>
                </div>
            </div>
            
            <div class="border-t border-slate-800 pt-8 text-xs text-slate-500 text-center md:text-left leading-relaxed">
                <p class="mb-2 text-sm font-medium text-slate-400">
                    &copy; Alpha Items Group <span id="current-year"></span>
                </p>
                <p class="max-w-5xl">
                    Alpha is authorised by the Financial Conduct Authority under the Electronic Money Regulations 2011, Firm Reference 900507, for the issuing of electronic money. Wise works with a local bank partner to offer the service in India with the approval of the Reserve Bank of India.
                </p>
            </div>
        </div>
    </footer>

    <!-- MAIN JAVASCRIPT -->
    <script>
        // --- CONSTANTS & EXTENDED CURRENCY DATA ---
        const CURRENCIES = [
            { code: 'USD', name: 'US Dollar', flag: 'us', symbol: '$' },
            { code: 'EUR', name: 'Euro', flag: 'eu', symbol: '€' },
            { code: 'GBP', name: 'British Pound', flag: 'gb', symbol: '£' },
            { code: 'JPY', name: 'Japanese Yen', flag: 'jp', symbol: '¥' },
            { code: 'AUD', name: 'Australian Dollar', flag: 'au', symbol: 'A$' },
            { code: 'CAD', name: 'Canadian Dollar', flag: 'ca', symbol: 'C$' },
            { code: 'CHF', name: 'Swiss Franc', flag: 'ch', symbol: 'CHF' },
            { code: 'CNY', name: 'Chinese Yuan', flag: 'cn', symbol: '¥' },
            { code: 'INR', name: 'Indian Rupee', flag: 'in', symbol: '₹' },
            { code: 'NZD', name: 'New Zealand Dollar', flag: 'nz', symbol: 'NZ$' },
            { code: 'AED', name: 'UAE Dirham', flag: 'ae', symbol: 'د.إ' },
            { code: 'ARS', name: 'Argentine Peso', flag: 'ar', symbol: '$' },
            { code: 'BRL', name: 'Brazilian Real', flag: 'br', symbol: 'R$' },
            { code: 'CZK', name: 'Czech Koruna', flag: 'cz', symbol: 'Kč' },
            { code: 'DKK', name: 'Danish Krone', flag: 'dk', symbol: 'kr' },
            { code: 'EGP', name: 'Egyptian Pound', flag: 'eg', symbol: 'E£' },
            { code: 'HKD', name: 'Hong Kong Dollar', flag: 'hk', symbol: 'HK$' },
            { code: 'HUF', name: 'Hungarian Forint', flag: 'hu', symbol: 'Ft' },
            { code: 'IDR', name: 'Indonesian Rupiah', flag: 'id', symbol: 'Rp' },
            { code: 'ILS', name: 'Israeli New Shekel', flag: 'il', symbol: '₪' },
            { code: 'KES', name: 'Kenyan Shilling', flag: 'ke', symbol: 'KSh' },
            { code: 'KRW', name: 'South Korean Won', flag: 'kr', symbol: '₩' },
            { code: 'KWD', name: 'Kuwaiti Dinar', flag: 'kw', symbol: 'KD' },
            { code: 'MXN', name: 'Mexican Peso', flag: 'mx', symbol: '$' },
            { code: 'MYR', name: 'Malaysian Ringgit', flag: 'my', symbol: 'RM' },
            { code: 'NGN', name: 'Nigerian Naira', flag: 'ng', symbol: '₦' },
            { code: 'NOK', name: 'Norwegian Krone', flag: 'no', symbol: 'kr' },
            { code: 'PHP', name: 'Philippine Peso', flag: 'ph', symbol: '₱' },
            { code: 'PKR', name: 'Pakistani Rupee', flag: 'pk', symbol: 'Rs' },
            { code: 'PLN', name: 'Polish Zloty', flag: 'pl', symbol: 'zł' },
            { code: 'QAR', name: 'Qatari Riyal', flag: 'qa', symbol: 'QR' },
            { code: 'RUB', name: 'Russian Ruble', flag: 'ru', symbol: '₽' },
            { code: 'SAR', name: 'Saudi Riyal', flag: 'sa', symbol: 'SR' },
            { code: 'SEK', name: 'Swedish Krona', flag: 'se', symbol: 'kr' },
            { code: 'SGD', name: 'Singapore Dollar', flag: 'sg', symbol: 'S$' },
            { code: 'THB', name: 'Thai Baht', flag: 'th', symbol: '฿' },
            { code: 'TRY', name: 'Turkish Lira', flag: 'tr', symbol: '₺' },
            { code: 'TWD', name: 'New Taiwan Dollar', flag: 'tw', symbol: 'NT$' },
            { code: 'VND', name: 'Vietnamese Dong', flag: 'vn', symbol: '₫' },
            { code: 'ZAR', name: 'South African Rand', flag: 'za', symbol: 'R' }
        ];

        // --- CUSTOM SELECT UI COMPONENT ---
        class CustomSelect {
            constructor(config) {
                this.container = document.getElementById(config.containerId);
                this.options = config.options; // Array of objects
                this.value = config.initialValue;
                this.onChange = config.onChange;
                this.allowNone = config.allowNone || false;
                this.compact = config.compact || false; // smaller UI for charts
                
                this.isOpen = false;
                this.render();
                this.attachEvents();
            }

            getSelectedObj() {
                if (this.allowNone && this.value === 'NONE') return { code: 'NONE', name: 'None - Single Chart', flag: null };
                return this.options.find(o => o.code === this.value) || this.options[0];
            }

            render() {
                const sel = this.getSelectedObj();
                const paddingClass = this.compact ? "px-3 py-2" : "px-4 py-4";
                const textClass = this.compact ? "text-sm" : "text-xl";
                
                let flagImg = sel.flag ? `<img src="https://flagcdn.com/w40/${sel.flag}.png" class="w-6 h-6 rounded-full object-cover shadow-sm shrink-0">` : `<div class="w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 shrink-0 flex justify-center items-center"><i data-lucide="minus" class="w-4 h-4 text-slate-400"></i></div>`;

                this.container.innerHTML = `
                    <div class="relative w-full h-full custom-select-wrapper">
                        <button type="button" class="select-trigger w-full h-full flex items-center justify-between ${paddingClass} bg-transparent outline-none">
                            <div class="flex items-center gap-3 overflow-hidden">
                                ${flagImg}
                                <span class="selected-text ${textClass} font-bold text-slate-900 dark:text-white truncate">
                                    ${sel.code === 'NONE' ? sel.name : `${sel.code} - ${sel.name}`}
                                </span>
                            </div>
                            <i data-lucide="chevron-down" class="chevron-icon w-5 h-5 text-slate-400 shrink-0 transition-transform duration-200"></i>
                        </button>
                        
                        <div class="select-dropdown absolute z-50 left-0 right-0 mt-2 bg-white/95 dark:bg-slate-800/95 backdrop-blur-2xl border border-slate-200 dark:border-slate-700 rounded-2xl shadow-2xl hidden origin-top transform opacity-0 scale-95 transition-all duration-200">
                            <div class="p-3 border-b border-slate-100 dark:border-slate-700">
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                                    <input type="text" placeholder="Search currency..." class="search-input w-full bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-white rounded-xl pl-9 pr-4 py-2.5 text-base md:text-sm outline-none focus:ring-2 focus:ring-blue-500/50 transition-shadow">
                                </div>
                            </div>
                            <div class="overflow-y-auto overscroll-contain custom-scrollbar max-h-[260px] rounded-b-2xl">
                                <ul class="options-list p-2 flex flex-col gap-0.5">
                                    ${this.renderOptionsList(this.options)}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            }

            renderOptionsList(opts) {
                let html = '';
                if (this.allowNone) {
                    const isSel = this.value === 'NONE';
                    html += `
                    <li>
                        <button type="button" data-value="NONE" class="option-btn w-full flex items-center justify-between px-3 py-2.5 rounded-xl transition-colors ${isSel ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400' : 'hover:bg-slate-50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-200'}">
                            <div class="flex items-center gap-3">
                                <div class="w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center shrink-0"><i data-lucide="minus" class="w-4 h-4 text-slate-400"></i></div>
                                <span class="font-semibold text-sm">None - Single Chart</span>
                            </div>
                            ${isSel ? '<i data-lucide="check" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>' : ''}
                        </button>
                    </li>`;
                }

                opts.forEach(opt => {
                    const isSel = this.value === opt.code;
                    html += `
                    <li>
                        <button type="button" data-value="${opt.code}" class="option-btn w-full flex items-center justify-between px-3 py-2.5 rounded-xl transition-colors ${isSel ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400' : 'hover:bg-slate-50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-200'}">
                            <div class="flex items-center gap-3">
                                <img src="https://flagcdn.com/w40/${opt.flag}.png" class="w-6 h-6 rounded-full object-cover shadow-sm shrink-0">
                                <span class="font-semibold text-sm text-left line-clamp-1">${opt.code} - ${opt.name}</span>
                            </div>
                            ${isSel ? '<i data-lucide="check" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>' : ''}
                        </button>
                    </li>`;
                });
                return html;
            }

            attachEvents() {
                const trigger = this.container.querySelector('.select-trigger');
                const dropdown = this.container.querySelector('.select-dropdown');
                const search = this.container.querySelector('.search-input');
                const chevron = this.container.querySelector('.chevron-icon');

                // Toggle dropdown
                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // Close all other dropdowns
                    document.querySelectorAll('.select-dropdown').forEach(dd => {
                        if (dd !== dropdown && !dd.classList.contains('hidden')) {
                            dd.classList.add('hidden');
                            dd.classList.replace('opacity-100', 'opacity-0');
                            dd.classList.replace('scale-100', 'scale-95');
                            const otherIcon = dd.parentElement.querySelector('.chevron-icon');
                            if(otherIcon) otherIcon.style.transform = 'rotate(0deg)';
                        }
                    });

                    this.isOpen = !this.isOpen;
                    if (this.isOpen) {
                        dropdown.classList.remove('hidden');
                        // Small delay to allow display:block to apply before animating opacity
                        setTimeout(() => {
                            dropdown.classList.replace('opacity-0', 'opacity-100');
                            dropdown.classList.replace('scale-95', 'scale-100');
                        }, 10);
                        chevron.style.transform = 'rotate(180deg)';
                        search.value = ''; // clear search on open
                        this.filterOptions('');
                        // Focus on desktop, avoid auto-focusing on mobile if it triggers zoom
                        if (window.innerWidth >= 768) {
                            setTimeout(() => search.focus(), 100);
                        }
                    } else {
                        this.closeDropdown(dropdown, chevron);
                    }
                });

                // Option clicks
                this.container.addEventListener('click', (e) => {
                    const btn = e.target.closest('.option-btn');
                    if (btn) {
                        const newVal = btn.dataset.value;
                        if (newVal !== this.value) {
                            this.setValue(newVal, true);
                        }
                        this.closeDropdown(dropdown, chevron);
                    }
                });

                // Search
                search.addEventListener('input', (e) => {
                    this.filterOptions(e.target.value.toLowerCase());
                });

                // Close on click outside
                document.addEventListener('click', (e) => {
                    if (this.isOpen && !this.container.contains(e.target)) {
                        this.closeDropdown(dropdown, chevron);
                    }
                });
            }

            filterOptions(query) {
                const list = this.container.querySelector('.options-list');
                const filteredOpts = this.options.filter(o => 
                    o.code.toLowerCase().includes(query) || 
                    o.name.toLowerCase().includes(query)
                );
                list.innerHTML = this.renderOptionsList(filteredOpts);
                lucide.createIcons(); // Re-init checkmarks
            }

            closeDropdown(dropdown, chevron) {
                this.isOpen = false;
                dropdown.classList.replace('opacity-100', 'opacity-0');
                dropdown.classList.replace('scale-100', 'scale-95');
                chevron.style.transform = 'rotate(0deg)';
                setTimeout(() => dropdown.classList.add('hidden'), 200); // wait for anim
            }

            setValue(newCode, triggerEvent = false) {
                this.value = newCode;
                // Re-render internally just to update the trigger and list UI safely
                this.render();
                this.attachEvents(); 
                if (triggerEvent && this.onChange) {
                    this.onChange(this.value);
                }
            }
        }


        // --- STATE & APP ---
        let state = {
            amount: 1000,
            fromCurrency: 'EUR',
            toCurrency: 'USD',
            rates: {},
            lastUpdated: null,
            isLoading: true,
            
            // Big Chart State
            chartView: {
                base: 'EUR',
                curr1: 'USD',
                curr2: 'NONE',
                timeframe: '1Y', // 1W, 1M, 1Y, 5Y
                instance: null
            }
        };

        // References to our class instances
        const selects = {
            from: null,
            to: null,
            chartBase: null,
            chartCurr1: null,
            chartCurr2: null
        };

        const els = {
            navPersonal: document.getElementById('nav-personal'),
            navChart: document.getElementById('nav-chart'),
            mobileNavPersonal: document.getElementById('mobile-nav-personal'),
            mobileNavChart: document.getElementById('mobile-nav-chart'),
            viewPersonal: document.getElementById('view-personal'),
            viewChart: document.getElementById('view-chart'),

            amountInput: document.getElementById('amount-input'),
            currencySymbol: document.getElementById('currency-symbol'),
            swapBtn: document.getElementById('swap-btn'),
            
            resultSkeleton: document.getElementById('result-skeleton'),
            resultData: document.getElementById('result-data'),
            
            displayAmount: document.getElementById('display-amount'),
            displayFromCurr: document.getElementById('display-from-curr'),
            displayResult: document.getElementById('display-result'),
            displayToCurr: document.getElementById('display-to-curr'),
            displayRate: document.getElementById('display-rate'),
            rateFromSpans: document.querySelectorAll('.rate-from'),
            rateToSpans: document.querySelectorAll('.rate-to'),
            lastUpdated: document.getElementById('last-updated'),
            
            errorContainer: document.getElementById('error-message'),
            errorText: document.getElementById('error-text'),
            
            ratesGrid: document.getElementById('rates-grid'),
            tableBaseCurrency: document.getElementById('table-base-currency'),
            refreshBtn: document.getElementById('refresh-rates-btn'),

            chartMainTitle: document.getElementById('chart-main-title'),
            chartMainChange: document.getElementById('chart-main-change'),
            chartMainSubtitle: document.getElementById('chart-main-subtitle'),
            chartCurrentRateText: document.getElementById('chart-current-rate-text'),
            chartDateText: document.getElementById('chart-date-text'),
            chartTimeframeBtns: document.querySelectorAll('.tf-btn'),
            chartCanvas: document.getElementById('big-chart'),
            chartComparisonNote: document.getElementById('chart-comparison-note'),
            
            chartStartDate: document.getElementById('chart-start-date'),
            chartEndDate: document.getElementById('chart-end-date'),
            applyCustomDateBtn: document.getElementById('apply-custom-date'),
            customDateRange: document.getElementById('custom-date-range'),

            themeToggles: [document.getElementById('theme-toggle'), document.getElementById('mobile-theme-toggle')],
            themeIcons: [document.getElementById('theme-icon'), document.getElementById('mobile-theme-icon')],
            
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mobileMenuIcon: document.getElementById('mobile-menu-icon'),
            mobileMenu: document.getElementById('mobile-menu')
        };

        function getSymbol(code) {
            const cur = CURRENCIES.find(c => c.code === code);
            return cur ? cur.symbol : code;
        }

        function init() {
            lucide.createIcons();
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Set default dates for the custom picker
            const today = new Date();
            const lastMonth = new Date();
            lastMonth.setMonth(today.getMonth() - 1);
            
            const fmtDate = (d) => {
                const offset = d.getTimezoneOffset();
                d = new Date(d.getTime() - (offset*60*1000));
                return d.toISOString().split('T')[0];
            };
            
            els.chartEndDate.value = fmtDate(today);
            els.chartStartDate.value = fmtDate(lastMonth);

            els.amountInput.value = state.amount;
            els.currencySymbol.textContent = getSymbol(state.fromCurrency);

            // Init Custom Selects
            selects.from = new CustomSelect({
                containerId: 'from-currency-container',
                options: CURRENCIES,
                initialValue: state.fromCurrency,
                onChange: (val) => {
                    state.fromCurrency = val;
                    els.currencySymbol.textContent = getSymbol(val);
                    fetchRates();
                }
            });

            selects.to = new CustomSelect({
                containerId: 'to-currency-container',
                options: CURRENCIES,
                initialValue: state.toCurrency,
                onChange: (val) => {
                    state.toCurrency = val;
                    updateConversion();
                }
            });

            // Chart Custom Selects
            selects.chartBase = new CustomSelect({
                containerId: 'chart-base-container',
                options: CURRENCIES,
                initialValue: state.chartView.base,
                compact: true,
                onChange: (val) => {
                    if(val === state.chartView.curr1) {
                        state.chartView.curr1 = state.chartView.base;
                        selects.chartCurr1.setValue(state.chartView.curr1);
                    }
                    state.chartView.base = val;
                    renderBigChart();
                }
            });

            selects.chartCurr1 = new CustomSelect({
                containerId: 'chart-curr1-container',
                options: CURRENCIES,
                initialValue: state.chartView.curr1,
                compact: true,
                onChange: (val) => {
                    if(val === state.chartView.base) {
                        state.chartView.base = state.chartView.curr1;
                        selects.chartBase.setValue(state.chartView.base);
                    }
                    state.chartView.curr1 = val;
                    renderBigChart();
                }
            });

            selects.chartCurr2 = new CustomSelect({
                containerId: 'chart-curr2-container',
                options: CURRENCIES,
                initialValue: state.chartView.curr2,
                allowNone: true,
                compact: true,
                onChange: (val) => {
                    state.chartView.curr2 = val;
                    renderBigChart();
                }
            });

            setupTheme();
            setupTabs();
            setupChartListeners();

            // Inputs & Swap
            els.amountInput.addEventListener('input', debounce((e) => {
                state.amount = parseFloat(e.target.value) || 0;
                updateConversion();
            }, 500));

            els.swapBtn.addEventListener('click', () => {
                // Spin animation logic
                const iconDesktop = els.swapBtn.querySelector('.md\\:block');
                const iconMobile = els.swapBtn.querySelector('.md\\:hidden');
                
                [iconDesktop, iconMobile].forEach(icon => {
                    icon.classList.add('spin-once');
                    setTimeout(() => icon.classList.remove('spin-once'), 300);
                });
                
                // State swap
                const temp = state.fromCurrency;
                state.fromCurrency = state.toCurrency;
                state.toCurrency = temp;
                
                // Update UI visually
                selects.from.setValue(state.fromCurrency);
                selects.to.setValue(state.toCurrency);
                els.currencySymbol.textContent = getSymbol(state.fromCurrency);
                
                fetchRates();
            });

            els.refreshBtn.addEventListener('click', fetchRates);

            // Mobile Menu
            let menuOpen = false;
            els.mobileMenuBtn.addEventListener('click', () => {
                menuOpen = !menuOpen;
                if(menuOpen) {
                    els.mobileMenu.classList.remove('hidden');
                    els.mobileMenuIcon.setAttribute('data-lucide', 'x');
                } else {
                    els.mobileMenu.classList.add('hidden');
                    els.mobileMenuIcon.setAttribute('data-lucide', 'menu');
                }
                lucide.createIcons();
            });

            // Initial Fetch
            fetchRates();
            setInterval(fetchRates, 60000);
        }

        // --- TAB NAVIGATION ---
        function setupTabs() {
            window.setTab = (tabName) => {
                if (tabName === 'personal') {
                    els.viewPersonal.classList.add('active');
                    els.viewChart.classList.remove('active');
                    
                    els.navPersonal.classList.replace('text-slate-300', 'text-blue-400');
                    els.navPersonal.classList.replace('border-transparent', 'border-blue-400');
                    els.navChart.classList.replace('text-blue-400', 'text-slate-300');
                    els.navChart.classList.replace('border-blue-400', 'border-transparent');

                    els.mobileNavPersonal.classList.replace('text-slate-300', 'text-blue-400');
                    els.mobileNavChart.classList.replace('text-blue-400', 'text-slate-300');
                } else {
                    els.viewPersonal.classList.remove('active');
                    els.viewChart.classList.add('active');
                    
                    els.navChart.classList.replace('text-slate-300', 'text-blue-400');
                    els.navChart.classList.replace('border-transparent', 'border-blue-400');
                    els.navPersonal.classList.replace('text-blue-400', 'text-slate-300');
                    els.navPersonal.classList.replace('border-blue-400', 'border-transparent');

                    els.mobileNavChart.classList.replace('text-slate-300', 'text-blue-400');
                    els.mobileNavPersonal.classList.replace('text-blue-400', 'text-slate-300');
                    
                    renderBigChart();
                }
                
                els.mobileMenu.classList.add('hidden');
                els.mobileMenuIcon.setAttribute('data-lucide', 'menu');
                lucide.createIcons();
            };

            els.navPersonal.addEventListener('click', () => window.setTab('personal'));
            els.mobileNavPersonal.addEventListener('click', () => window.setTab('personal'));
            els.navChart.addEventListener('click', () => window.setTab('chart'));
            els.mobileNavChart.addEventListener('click', () => window.setTab('chart'));
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function getMock24hChange(currency) {
            let hash = 0;
            for (let i = 0; i < currency.length; i++) hash += currency.charCodeAt(i);
            return (hash % 100) / 100 * 2 - 1; 
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 4); 
                const currentVal = start + (end - start) * ease;
                
                obj.innerHTML = currentVal.toLocaleString(undefined, { minimumFractionDigits: 4, maximumFractionDigits: 4 });
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        // --- CONVERTER & TABLE LOGIC ---
        function generateMockRates(base) {
            // Provide realistic fallback approximations to prevent application breakage if API is down
            const baseMockRatesToUSD = {
                USD: 1, EUR: 0.92, GBP: 0.79, JPY: 150.5, AUD: 1.53, CAD: 1.35, CHF: 0.88, CNY: 7.2, INR: 83.1, NZD: 1.65, ZAR: 18.9, SGD: 1.34
            };
            const rates = {};
            const baseUsdRate = baseMockRatesToUSD[base] || (Math.random() * 2 + 0.5);
            
            CURRENCIES.forEach(c => {
                if (c.code === base) {
                    rates[c.code] = 1;
                } else {
                    const targetUsdRate = baseMockRatesToUSD[c.code] || (Math.random() * 50 + 1);
                    let rate = targetUsdRate / baseUsdRate;
                    rate = rate * (1 + (Math.random() * 0.01 - 0.005)); // +/- 0.5% noise
                    rates[c.code] = rate;
                }
            });
            return rates;
        }

        async function fetchRates() {
            showLoading(true);
            try {
                els.errorContainer.classList.add('hidden');
                
                // Add an abort controller to prevent hanging forever on dropped connections
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 6000);
                
                const response = await fetch(`https://open.er-api.com/v6/latest/${state.fromCurrency}`, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                if (data.result === "success") {
                    state.rates = data.rates;
                    state.lastUpdated = new Date(data.time_last_update_unix * 1000);
                } else {
                    throw new Error("API returned failure payload");
                }
            } catch (err) {
                console.error("Fetch failed. Using simulated offline data:", err);
                els.errorText.textContent = 'Live rates unavailable. Using simulated offline data.';
                els.errorContainer.classList.remove('hidden');
                
                // Graceful fallback so the UI still functions
                state.rates = generateMockRates(state.fromCurrency);
                state.lastUpdated = new Date();
            } finally {
                updateConversion();
                renderCards();
                
                if(els.viewChart.classList.contains('active')) {
                    renderBigChart();
                }
                showLoading(false);
            }
        }

        function showLoading(isLoading) {
            state.isLoading = isLoading;
            if (isLoading) {
                els.resultSkeleton.classList.remove('hidden');
                els.resultData.classList.add('hidden');
                renderCardsSkeleton();
            } else {
                els.resultSkeleton.classList.add('hidden');
                els.resultData.classList.remove('hidden');
            }
        }

        function updateConversion() {
            if (!state.rates[state.toCurrency]) return;
            
            const rate = state.rates[state.toCurrency];
            const result = state.amount * rate;
            
            els.displayAmount.textContent = state.amount.toLocaleString();
            els.displayFromCurr.textContent = state.fromCurrency;
            els.displayToCurr.textContent = state.toCurrency;
            els.displayRate.textContent = rate.toFixed(6);
            
            els.rateFromSpans.forEach(span => span.textContent = state.fromCurrency);
            els.rateToSpans.forEach(span => span.textContent = state.toCurrency);
            
            if (state.lastUpdated) {
                els.lastUpdated.textContent = state.lastUpdated.toLocaleTimeString() + ' UTC';
            }

            const currentDisplayed = parseFloat(els.displayResult.textContent.replace(/,/g, '')) || 0;
            animateValue(els.displayResult, currentDisplayed, result, 800);
        }

        function renderCardsSkeleton() {
            let html = '';
            for(let i=0; i<8; i++) {
                html += `
                <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-6 shadow-sm animate-pulse">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-6 h-6 bg-slate-200 dark:bg-slate-800 rounded-full"></div>
                        <div class="h-4 w-24 bg-slate-200 dark:bg-slate-800 rounded"></div>
                    </div>
                    <div class="h-3 w-24 bg-slate-200 dark:bg-slate-800 rounded mb-2"></div>
                    <div class="h-8 w-32 bg-slate-200 dark:bg-slate-800 rounded mb-4"></div>
                    <div class="h-4 w-40 bg-slate-200 dark:bg-slate-800 rounded mb-6"></div>
                    <div class="h-4 w-20 bg-slate-200 dark:bg-slate-800 rounded"></div>
                </div>`;
            }
            els.ratesGrid.innerHTML = html;
        }

        function renderCards() {
            els.tableBaseCurrency.textContent = state.fromCurrency;

            let html = '';
            const topCurrencies = ['USD', 'EUR', 'GBP', 'JPY', 'AUD', 'CAD', 'CHF', 'CNY', 'INR', 'ZAR', 'SGD', 'NZD'];
            const filteredCurrencies = topCurrencies.filter(c => c !== state.fromCurrency).slice(0, 8); 
            
            filteredCurrencies.forEach(currency => {
                const rate = state.rates[currency] || 0;
                const changePct = getMock24hChange(currency);
                const isPositive = changePct >= 0;
                const changeAmt = rate * (Math.abs(changePct) / 100);
                
                const curObj = CURRENCIES.find(c => c.code === currency) || {name: currency, flag: currency.toLowerCase().substring(0,2)};
                
                const colorClass = isPositive ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400';
                const sign = isPositive ? '+' : '-';

                html += `
                <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center gap-3 mb-6">
                        <img src="https://flagcdn.com/w40/${curObj.flag}.png" alt="${currency}" class="w-6 h-6 rounded-full object-cover shadow-sm" />
                        <span class="font-semibold text-sm text-slate-800 dark:text-slate-200">${curObj.name}</span>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-[13px] text-slate-500 dark:text-slate-400 mb-1">1 ${state.fromCurrency} equals to</p>
                        <h4 class="text-[22px] font-bold text-slate-900 dark:text-white tracking-tight">${rate.toFixed(5)} ${currency}</h4>
                        <p class="text-xs font-medium ${colorClass} mt-1.5">
                            ${sign}${changeAmt.toFixed(4)} (${Math.abs(changePct).toFixed(2)}%) <span class="text-slate-400 dark:text-slate-500 font-normal ml-0.5">Weekly</span>
                        </p>
                    </div>
                    
                    <button onclick="viewChartFor('${currency}')" class="text-sm font-semibold text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 flex items-center gap-1 mt-6 transition-colors">
                        View chart <i data-lucide="arrow-right" class="w-3.5 h-3.5 ml-0.5"></i>
                    </button>
                </div>`;
            });

            els.ratesGrid.innerHTML = html;
            lucide.createIcons();
        }

        window.viewChartFor = function(currency) {
            state.chartView.base = state.fromCurrency;
            state.chartView.curr1 = currency;
            state.chartView.curr2 = 'NONE';
            
            selects.chartBase.setValue(state.chartView.base);
            selects.chartCurr1.setValue(state.chartView.curr1);
            selects.chartCurr2.setValue(state.chartView.curr2);
            
            window.setTab('chart');
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        // --- BIG CHART LOGIC ---
        function setupChartListeners() {
            els.chartTimeframeBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    els.chartTimeframeBtns.forEach(b => {
                        b.classList.remove('bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-600/20');
                        b.classList.add('text-slate-500', 'hover:bg-slate-100', 'dark:hover:bg-slate-800');
                    });
                    
                    const target = e.currentTarget;
                    target.classList.remove('text-slate-500', 'hover:bg-slate-100', 'dark:hover:bg-slate-800');
                    target.classList.add('bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-600/20');

                    state.chartView.timeframe = target.dataset.tf;
                    
                    if (state.chartView.timeframe === 'CUSTOM') {
                        els.customDateRange.classList.remove('hidden');
                        els.customDateRange.classList.add('flex');
                    } else {
                        els.customDateRange.classList.add('hidden');
                        els.customDateRange.classList.remove('flex');
                        renderBigChart();
                    }
                });
            });

            els.applyCustomDateBtn.addEventListener('click', () => {
                renderBigChart();
            });
        }

        function generateMockTimeSeries(latestRate, startDate, endDate, isIndex = false, pairString = "DEFAULT") {
            let labels = [];
            let data = [];
            
            const start = new Date(startDate);
            start.setHours(0,0,0,0);
            const end = new Date(endDate);
            end.setHours(0,0,0,0);
            const today = new Date();
            today.setHours(0,0,0,0);

            let daysToEnd = Math.floor((today - end) / (1000 * 60 * 60 * 24));
            if (daysToEnd < 0) daysToEnd = 0; 
            
            let rangeDays = Math.floor((end - start) / (1000 * 60 * 60 * 24));
            if (rangeDays < 0) rangeDays = 0;
            if (rangeDays === 0) rangeDays = 1; 

            let currentRate = latestRate;
            let volatility = 0.005; // daily volatility

            // PRNG Seed based on currency pair so chart shape is persistent across timeframes
            let seed = 0;
            for (let i = 0; i < pairString.length; i++) {
                seed = (seed << 5) - seed + pairString.charCodeAt(i);
                seed |= 0; 
            }
            seed += today.getFullYear() * 100 + today.getMonth(); // Rotate seed monthly

            function pseudoRandom() {
                var x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            }

            // Walk back from today to 'end' date
            for (let i = 0; i < daysToEnd; i++) {
                currentRate = currentRate / (1 + (pseudoRandom() * 2 - 1) * volatility);
            }

            let prices = [currentRate];
            
            // Walk back from 'end' to 'start' date to generate chart shape
            for (let i = 1; i <= rangeDays; i++) {
                currentRate = currentRate / (1 + (pseudoRandom() * 2 - 1) * volatility);
                prices.push(currentRate);
            }
            
            prices.reverse(); // put chronological order

            // Generate Labels WITH Year
            for (let i = rangeDays; i >= 0; i--) {
                const d = new Date(end);
                d.setDate(d.getDate() - i);
                labels.push(d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' }));
            }

            if (isIndex) {
                const startPrice = prices[0];
                data = prices.map(p => ((p / startPrice) - 1) * 100); 
            } else {
                data = prices;
            }

            return { labels, data };
        }

        function getCrossRate(fromCode, toCode) {
            if (fromCode === toCode) return 1;
            
            const getRate = (code) => {
                if (code === state.fromCurrency) return 1;
                return state.rates[code] || null;
            };

            const rFrom = getRate(fromCode);
            const rTo = getRate(toCode);
            
            if (rFrom && rTo) {
                return rTo / rFrom;
            }
            return (Math.random() * 1.5) + 0.5; // fallback
        }

        async function renderBigChart() {
            let actualRate1 = getCrossRate(state.chartView.curr1, state.chartView.base);
            let actualRate2 = 1;

            if(state.chartView.curr2 !== 'NONE') {
                actualRate2 = getCrossRate(state.chartView.curr2, state.chartView.base);
            }

            let endDate = new Date();
            let startDate = new Date();

            if(state.chartView.timeframe === '1W') {
                startDate.setDate(endDate.getDate() - 7);
            } else if(state.chartView.timeframe === '1M') {
                startDate.setMonth(endDate.getMonth() - 1);
            } else if(state.chartView.timeframe === '1Y') {
                startDate.setFullYear(endDate.getFullYear() - 1);
            } else if(state.chartView.timeframe === '5Y') {
                startDate.setFullYear(endDate.getFullYear() - 5);
            } else if(state.chartView.timeframe === 'CUSTOM') {
                const sVal = els.chartStartDate.value;
                const eVal = els.chartEndDate.value;
                if(sVal && eVal) {
                    startDate = new Date(sVal);
                    endDate = new Date(eVal);
                    // Prevent inverted ranges
                    if(startDate > endDate) {
                        let temp = startDate;
                        startDate = endDate;
                        endDate = temp;
                        els.chartStartDate.value = eVal;
                        els.chartEndDate.value = sVal;
                    }
                } else {
                    startDate.setMonth(endDate.getMonth() - 1); // fallback
                }
            }

            const isComparison = state.chartView.curr2 !== 'NONE';
            const pair1String = `${state.chartView.curr1}-${state.chartView.base}`;
            const pair2String = `${state.chartView.curr2}-${state.chartView.base}`;
            
            // Generate Data via custom dates
            const series1 = generateMockTimeSeries(actualRate1, startDate, endDate, isComparison, pair1String);
            const series2 = isComparison ? generateMockTimeSeries(actualRate2, startDate, endDate, isComparison, pair2String) : null;

            const startVal1 = series1.data[0];
            const endVal1 = series1.data[series1.data.length - 1];
            let percentChange = isComparison ? endVal1 : ((endVal1 - startVal1) / startVal1) * 100;
            const isPositive = percentChange >= 0;
            
            const curr1Name = CURRENCIES.find(c => c.code === state.chartView.curr1)?.name || state.chartView.curr1;
            const baseName = CURRENCIES.find(c => c.code === state.chartView.base)?.name || state.chartView.base;

            if (isComparison) {
                els.chartMainTitle.textContent = `${state.chartView.curr1} & ${state.chartView.curr2} vs ${state.chartView.base}`;
                els.chartMainSubtitle.textContent = `Comparison tracking percentage change against ${baseName}`;
                els.chartCurrentRateText.textContent = `Comparing Performance`;
                els.chartComparisonNote.classList.remove('hidden');
            } else {
                els.chartMainTitle.textContent = `${state.chartView.curr1} to ${state.chartView.base} Chart`;
                els.chartMainSubtitle.textContent = `${curr1Name} to ${baseName}`;
                els.chartCurrentRateText.textContent = `1 ${state.chartView.curr1} = ${endVal1.toFixed(4)} ${state.chartView.base}`;
                els.chartComparisonNote.classList.add('hidden');
            }
            
            els.chartMainChange.textContent = `${isPositive ? '+' : ''}${percentChange.toFixed(2)}% (${state.chartView.timeframe})`;
            els.chartMainChange.className = `text-base md:text-lg px-3 py-1 rounded-full font-bold ${isPositive ? 'text-emerald-600 bg-emerald-100 dark:bg-emerald-900/40 dark:text-emerald-400' : 'text-red-600 bg-red-100 dark:bg-red-900/40 dark:text-red-400'}`;
            
            els.chartDateText.textContent = new Date().toLocaleString(undefined, { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' });

            const ctx = els.chartCanvas.getContext('2d');
            
            const gradientBlue = ctx.createLinearGradient(0, 0, 0, 400);
            gradientBlue.addColorStop(0, 'rgba(37, 99, 235, 0.4)'); 
            gradientBlue.addColorStop(1, 'rgba(37, 99, 235, 0.0)');

            const gradientPurple = ctx.createLinearGradient(0, 0, 0, 400);
            gradientPurple.addColorStop(0, 'rgba(147, 51, 234, 0.4)'); 
            gradientPurple.addColorStop(1, 'rgba(147, 51, 234, 0.0)');

            const datasets = [{
                label: state.chartView.curr1,
                data: series1.data,
                borderColor: '#2563eb', 
                backgroundColor: gradientBlue,
                borderWidth: 2,
                fill: true,
                pointRadius: 0,
                pointHoverRadius: 6,
                tension: 0.1
            }];

            if (isComparison) {
                datasets.push({
                    label: state.chartView.curr2,
                    data: series2.data,
                    borderColor: '#9333ea', 
                    backgroundColor: gradientPurple,
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    tension: 0.1
                });
            }

            if (state.chartView.instance) {
                state.chartView.instance.destroy();
            }

            const isDark = document.documentElement.classList.contains('dark');
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)';
            const tickColor = isDark ? 'rgba(255, 255, 255, 0.5)' : 'rgba(0, 0, 0, 0.5)';

            state.chartView.instance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: series1.labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: isComparison,
                            position: 'top',
                            labels: { color: tickColor, font: { family: 'Inter', weight: '500' } }
                        },
                        tooltip: {
                            backgroundColor: isDark ? 'rgba(15, 23, 42, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                            titleColor: isDark ? '#fff' : '#0f172a',
                            bodyColor: isDark ? '#cbd5e1' : '#475569',
                            borderColor: isDark ? '#334155' : '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            titleFont: { size: 14, family: 'Inter', weight: 'bold' },
                            bodyFont: { size: 13, family: 'Inter' },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (isComparison) {
                                            label += context.parsed.y.toFixed(2) + '%';
                                        } else {
                                            label += context.parsed.y.toFixed(5);
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { 
                                maxTicksLimit: 6, 
                                color: tickColor,
                                font: { family: 'Inter' }
                            }
                        },
                        y: {
                            grid: { color: gridColor, drawBorder: false },
                            ticks: { 
                                color: tickColor,
                                font: { family: 'Inter' },
                                callback: function(value) {
                                    return isComparison ? value + '%' : value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- THEME MANAGEMENT ---
        function setupTheme() {
            let isDark = false;
            const savedTheme = localStorage.getItem('fxpro_theme');
            
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                isDark = true;
                document.documentElement.classList.add('dark');
            }

            const updateIcons = () => {
                const iconName = isDark ? 'sun' : 'moon';
                els.themeIcons.forEach(icon => {
                    if(icon) icon.setAttribute('data-lucide', iconName);
                });
                lucide.createIcons();
                if(state.chartView.instance) renderBigChart(); 
            };
            updateIcons();

            const toggleTheme = () => {
                isDark = !isDark;
                if (isDark) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('fxpro_theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('fxpro_theme', 'light');
                }
                updateIcons();
            };

            els.themeToggles.forEach(toggle => {
                if(toggle) toggle.addEventListener('click', toggleTheme);
            });
        }

        // Boot
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
